---
tags: [ kernel ] 
layout: post
date: 2014-12-28
title: Linux memory management
category: cs
---

# GFP flags
__GFP_THISNODE: 9b819d204cf602eab1a53a9ec4b8d2ca51e02a1d - Add __GFP_THISNODE to avoid fallback to other nodes and ignore cpuset/memory policy restrictions
__GFP_IO: allow disk IO
__GFP_FS: allow fs operations, depend on io.
[Avoiding memory-allocation deadlocks](https://lwn.net/Articles/594725/)
[Understanding __GFP_FS](https://lwn.net/Articles/596618/)

## Zone watermarks 
core_initcall(init_per_zone_wmark_min)
build_all_zonelists: Just init zones, nothing else. But we have vm_total_pages/zone->managed_pages initialized in free_all_bootmem();.
page_alloc_init // drain percpu pageset when cpu dead or dead frozen for CPU hotplug
## Optimization - Hot and cold pages
[Hot and cold pages](https://lwn.net/Articles/14768/)
per_cpu_pageset
## Per cpu variable
Where is Per-CPU variable?
static Per-CPU in .data(?) below high_memory!
runtime Per-CPU, it's GFP_KERNEL in pcpu_create_chunk()

# Hot cold page
[mm, Remove cold parameter from free_hot_cold_page*](https://patchwork.kernel.org/patch/10013971/)
